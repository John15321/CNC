
/**
 * Check whether the format of input numbers, formulas and units are incorrect
 *
 * @copyright &copy; 2010-2011 Hon Wai, Lau
 * @author Hon Wai, Lau <lau65536@gmail.com>
 * @license http://www.gnu.org/copyleft/gpl.html GNU Public License version 3
 */
function formulas_format_check(){var use_format_check=!0;var show_hinting_type=null;var show_interpretation=null;var show_warning=null;var unittest_fail_show_icon=!0;var unittest_fail_show_details=!1;var types=[['unit',!0,!0,!0],['number',!0,!0,!0],['number_unit',!0,!0,!0],['numeric',!0,!0,!0],['numeric_unit',!0,!0,!0],['numerical_formula',!0,!0,!0],['numerical_formula_unit',!0,!0,!0],['algebraic_formula',!0,!0,!0],['editing_unit',!0,!0,!0]];var constlist={'pi':'3.14159265358979323846'};var funclist={'sin':1,'cos':1,'tan':1,'asin':1,'acos':1,'atan':1,'exp':1,'log10':1,'ln':1,'sqrt':1,'abs':1,'ceil':1,'floor':1,'fact':1};var evalreplacelist={'ln':'log','log10':'(1./log(10.))*log'};var dispreplacelist={'log10':'log<sub>10</sub>','3.14159265358979323846':'<i>Ï€</i>'};if(!use_format_check)return;for(var i=0;i<types.length;i++){if(show_hinting_type!=null)types[i][1]=show_hinting_type;if(show_interpretation!=null)types[i][2]=show_interpretation;if(show_warning!=null)types[i][3]=show_warning}
var fn={stop:function(common,self){if(!common.ready||!common.pass)return;self.info.style.display='none';common.fn.update(common,self)},monitor:function(common,self){if(!common.ready||!common.pass)return;self.info.style.display=self.show_info?'block':'none';common.fn.update(common,self)},update:function(common,self){if(self.input.value.length>128)self.input.value=self.input.value.substr(0,128);if(!common.ready||!common.pass)return;self.cur_value=common.fn.trim(self.input.value);if(self.last_value!=null&&self.last_value==self.cur_value)return;self.last_value=self.cur_value;self.answered=self.input.value==''?!1:!0;var info=self.answered?common.fn[self.func](common.fn,self.cur_value):'';self.correct=(info!=null);info=(info!=null)?common.fn.trim(info):'';self.warning.style.display=(self.show_sign&&self.answered&&!self.correct)?'block':'none';if(self.correct){self.interpretation.innerHTML=info;self.interpretation.style.display=(self.show_interpretation&&self.cur_value!=info)?'block':'none';self.interpretation.className='formulas_input_info_interpretation'}else self.interpretation.className='formulas_input_info_interpretation_incorrect'},check_unit:function(fn,value){var base_units=null;try{base_units=fn.parse_unit(fn,value)}catch(e){}
if(base_units==null)return null;return fn.format_unit(base_units)},check_number:function(fn,value){var v=fn.get_formula_information(fn,value);if(v==null)return null;if(/^[-+]?@0$/.test(v.sub)==!1)return null;if(!((v.lengths.n==1)&&(v.lengths.f==0)&&(v.lengths.v==0)))return null;return fn.format_number(value)},check_number_unit:function(fn,value){var splitted=fn.split_formula_unit(fn,value);var n=fn.check_number(fn,splitted[0]);var u=fn.check_unit(fn,splitted[1]);if(n==null||u==null)return null;return n+' '+u},check_numeric:function(fn,value){var v=fn.get_formula_information(fn,value);if(v==null)return null;if(/^[ )(^\/*+-]*$/.test(v.remaining)==!1)return null;if(!((v.lengths.f==0)&&(v.lengths.v==0)))return null;if(fn.test_evaluation(fn,v,v.sub)==null)return null;var n=fn.check_number(fn,value);return n!=null?n:fn.replace_display_formula(fn,v,v.sub)},check_numeric_unit:function(fn,value){var splitted=fn.split_formula_unit(fn,value);var n=fn.check_numeric(fn,splitted[0]);var u=fn.check_unit(fn,splitted[1]);if(n==null||u==null)return null;return n+' '+u},check_numerical_formula:function(fn,value){var v=fn.get_formula_information(fn,value);if(v==null)return null;if(/^[ )(^\/*+-]*$/.test(v.remaining)==!1)return null;if(!((v.lengths.v==0)))return null;if(fn.test_evaluation(fn,v,v.sub)==null)return null;var n=fn.check_number(fn,value);return n!=null?n:fn.replace_display_formula(fn,v,v.sub)},check_numerical_formula_unit:function(fn,value){var splitted=fn.split_formula_unit(fn,value);var n=fn.check_numerical_formula(fn,splitted[0]);var u=fn.check_unit(fn,splitted[1]);if(n==null||u==null)return null;return n+' '+u},check_algebraic_formula:function(fn,value){var v=fn.get_formula_information(fn,value);if(v==null)return null;if(/^[ )(^\/*+-]*$/.test(v.remaining)==!1)return null;var variables={};for(var key in v.all)variables[key]=v.all[key];for(var key in v.all)if(v.all[key]!=null&&v.all[key].type=='v')v.all[key]={'type':'n','value':1.};if(fn.test_evaluation(fn,v,v.sub)==null)return null;for(var key in v.all)v.all[key]=variables[key];return fn.replace_display_formula(fn,v,v.sub)},check_editing_unit:function(fn,value){var unit_lists=value.split('=');var correct=!0;var formatted=[];for(var i=0;i<unit_lists.length;i++)try{var base_units=fn.parse_unit(common.fn,unit_lists[i]);correct=correct&&(base_units!=null)&&(fn.trim(unit_lists[i]).length!=0);formatted.push(fn.format_unit(base_units))}catch(e){correct=!1}
if(!correct){return null}
return formatted.join(' = ')},test_evaluation:function(fn,vstack,formula){try{var v=fn.replace_vstack_variables(fn,vstack,evalreplacelist);var expr=fn.replace_evaluation_formula(fn,v,formula);var expr=fn.substitute_placeholders_in_text(fn,v,expr);var res;eval('with(Math) { res = '+expr+'; }');return res}catch(e){return null}},vstack_create:function(){return{idcounter:0,all:{}}},vstack_get_variable:function(vstack,name){return(name in vstack.all?vstack.all[name]:null)},vstack_add_temporary_variable:function(vstack,type,value){var name='@'+vstack.idcounter;vstack.all[name]={'type':type,'value':value};vstack.idcounter++;return name},substitute_placeholders_in_text:function(fn,vstack,text){var splitted=text.replace(/(@[0-9]+)/g,'`$1`').split('`');for(var i=1;i<splitted.length;i+=2)
splitted[i]=fn.vstack_get_variable(vstack,splitted[i]).value;return splitted.join('')},substitute_numbers_by_placeholders:function(fn,vstack,text){var numPattern=/(^|[\]\[)(}{, ?:><=~!|&%^\/*+-])(([0-9]+\.?[0-9]*|[0-9]*\.?[0-9]+)([eE][-+]?[0-9]+)?)/g;var splitted=text.replace(numPattern,'$1`$2`').split('`');for(var i=1;i<splitted.length;i+=2)
splitted[i]=fn.vstack_add_temporary_variable(vstack,'n',splitted[i]);return splitted.join('')},substitute_functions_by_placeholders:function(fn,vstack,text){var funcPattern=/([a-z][a-z0-9_]*)(\s*\()/g;var splitted=text.replace(funcPattern,'`$1`$2').split('`');for(var i=1;i<splitted.length;i+=2){if(!(splitted[i]in funclist))continue;splitted[i]=fn.vstack_add_temporary_variable(vstack,'f',splitted[i])}
return splitted.join('')},substitute_constants_by_placeholders:function(fn,vstack,text,preserve){var varPattern=/([A-Za-z][A-Za-z0-9_]*)/g;var splitted=text.replace(varPattern,'`$1`').split('`');for(var i=1;i<splitted.length;i+=2){if(!(splitted[i]in constlist))continue;var constnumber=preserve?splitted[i]:constlist[splitted[i]];splitted[i]=fn.vstack_add_temporary_variable(vstack,'n',constnumber)}
return splitted.join('')},substitute_variables_by_placeholders:function(fn,vstack,text){var varPattern=/([A-Za-z][A-Za-z0-9_]*)/g;var splitted=text.replace(varPattern,'`$1`').split('`');for(var i=1;i<splitted.length;i+=2){if(splitted[i]in funclist)continue;splitted[i]=fn.vstack_add_temporary_variable(vstack,'v',splitted[i])}
return splitted.join('')},get_formula_information:function(fn,str){if(/^[A-Za-z0-9._ )(^\/*+-]*$/.test(str)==!1)return null;var v=fn.vstack_create();var sub=str;var sub=fn.substitute_numbers_by_placeholders(fn,v,sub);var sub=fn.substitute_functions_by_placeholders(fn,v,sub);var sub=fn.substitute_constants_by_placeholders(fn,v,sub,!1);var sub=fn.substitute_variables_by_placeholders(fn,v,sub);v.lengths={'n':0,'v':0,'f':0};for(var data in v.all)v.lengths[v.all[data].type]++;v.original=str;v.sub=sub;v.remaining=v.sub.replace(/@[0-9]+/g,'');return v},split_formula_unit:function(fn,str){if(/[`@]/.test(str)==!0)return['',str];var v=fn.vstack_create();var sub=str;var sub=fn.substitute_numbers_by_placeholders(fn,v,sub);var sub=fn.substitute_functions_by_placeholders(fn,v,sub);var sub=fn.substitute_constants_by_placeholders(fn,v,sub,!0);var loc=sub.search(/([^@0-9 )(^\/*+-])/);var num=fn.substitute_placeholders_in_text(fn,v,(loc==-1)?sub:sub.substr(0,loc));var unit=(loc==-1)?'':fn.substitute_placeholders_in_text(fn,v,sub.substr(loc));return[fn.trim(num),fn.trim(unit)]},replace_vstack_variables:function(fn,vstack,replacementlist){var res={idcounter:vstack.idcounter,all:{}};for(var key in vstack.all)res.all[key]={'type':vstack.all[key].type,'value':vstack.all[key].value};for(var key in res.all){var tmp=res.all[key];if(tmp.value in replacementlist)tmp.value=replacementlist[tmp.value]}
return res},insert_multiplication_for_juxtaposition:function(fn,vstack,text){var splitted=text.replace(/(@[0-9]+)/g,'`$1`').split('`');for(var i=3;i<splitted.length;i+=2){var op=fn.trim(splitted[i-1]);if(fn.vstack_get_variable(vstack,splitted[i-2]).type=='f')continue;if(op.length==0)op=' * ';else if(op[0]=='(')op=' * '+op;else if(op[op.length-1]==')')op=op+' * ';else op=op.replace(/^(\))(\s*)(\()/g,'$1 * $3');splitted[i-1]=op}
return splitted.join('')},replace_caret_by_power:function(fn,vstack,text){while(!0){var loc=text.lastIndexOf('^');if(loc<0)break;var rloc=loc;if(rloc+1<text.length&&text[rloc+1]=='-')rloc+=1;var r=fn.get_next_variable(fn,vstack,text,rloc+1);if(r!=null)rloc=r.endloc-1;if(r==null||(r!=null&&r.variable.type=='f')){var rtmp=fn.get_expressions_in_bracket(text,rloc+1,'(',{'(':')'});if(rtmp==null||rtmp.openloc!=rloc+1)throw 'Expression expected';rloc=rtmp.closeloc}
var lloc=loc;var l=fn.get_previous_variable(fn,vstack,text,loc);if(l!=null)
lloc=l.startloc;else{var reverse=text.split('').reverse().join('');var ltmp=fn.get_expressions_in_bracket(reverse,text.length-1-loc+1,')',{')':'('});if(ltmp==null||ltmp.openloc!=text.length-1-loc+1)throw 'Expression expected';var lfunc=fn.get_previous_variable(fn,vstack,text,text.length-1-ltmp.closeloc);lloc=(lfunc==null||lfunc.variable.type!='f')?text.length-1-ltmp.closeloc:lfunc.startloc}
var name=fn.vstack_add_temporary_variable(vstack,'f','pow');text=text.substr(0,lloc)+name+'('+text.substr(lloc,loc-lloc)+', '+text.substr(loc+1,rloc-loc)+')'+text.substr(rloc+1)}
return text},replace_evaluation_formula:function(fn,vstack,text){text=fn.insert_multiplication_for_juxtaposition(fn,vstack,text);text=fn.replace_caret_by_power(fn,vstack,text);text=text.replace(/\s*([)(\/*+-])\s*/g,'$1');return text},replace_display_formula:function(fn,vstack,text){var vstack=fn.replace_vstack_variables(fn,vstack,dispreplacelist);text=fn.replace_evaluation_formula(fn,vstack,text);var splitted=text.replace(/(@[0-9]+)/g,'`$1`').split('`');for(var i=3;i<splitted.length;i+=2){if(fn.trim(splitted[i-1])=='*'){var left=fn.vstack_get_variable(vstack,splitted[i-2]);var right=fn.vstack_get_variable(vstack,splitted[i]);splitted[i-1]=(left.type=='n'&&right.type=='n')?'\u00D7':'\u00b7'}
splitted[i-1]=splitted[i-1].replace('*','\u00b7')}
text=splitted.join('');for(var key in vstack.all)if(vstack.all[key]!=null){if(vstack.all[key].type=='v')vstack.all[key].value='<i>'+vstack.all[key].value+'</i>';if(vstack.all[key].type=='n')vstack.all[key].value=fn.format_number(vstack.all[key].value,!0)}
text=fn.substitute_placeholders_in_text(fn,vstack,text);while(!0){var loc=text.lastIndexOf('pow');if(loc<0)break;var b=fn.get_expressions_in_bracket(text,loc+1,'(',{'(':')'});var base=fn.trim(b.expressions[0]);if(base[0]!='('&&base.indexOf('(')>=0)base='('+base+')';var expo=fn.trim(b.expressions[1]);if(expo[0]=='('&&expo[expo.length-1]==')')expo=expo.substr(1,expo.length-2);text=text.substr(0,loc)+base+'<sup>'+expo+'</sup>'+text.substr(b.closeloc+1)}
return text},get_expressions_in_bracket:function(text,start,open,bset){var bflip={};for(var b in bset)bflip[bset[b]]=b;var ostack=[];for(var i=start;i<text.length;i++){if(text[i]==open)ostack.push(open);if(ostack.length>0)break}
if(ostack.length==0){return null}
var firstopenloc=i;var expressions=[];var ploc=i+1;for(var i=ploc;i<text.length;i++){if(text[i]in bset)ostack.push(text[i]);if(text[i]==','&&ostack.length==1){expressions.push(text.substr(ploc,i-ploc));ploc=i+1}
if(text[i]in bflip)if(ostack.pop()!=bflip[text[i]])break;if(ostack.length==0){expressions.push(text.substr(ploc,i-ploc));return{'openloc':firstopenloc,'closeloc':i,'expressions':expressions}}}
throw 'error_bracket_mismatch'},get_previous_variable:function(fn,vstack,text,loc){var m=/((@[0-9]+)\s*)$/.exec(text.substr(0,loc));if(m==null)return null;var v=fn.vstack_get_variable(vstack,m[2]);if(v==null)return null;return{'startloc':(loc-m[1].length),'variable':v}},get_next_variable:function(fn,vstack,text,loc){var m=/^(\s*(@[0-9]+))/.exec(text.substr(loc));if(m==null)return null;var v=fn.vstack_get_variable(vstack,m[2]);if(v==null)return null;return{'startloc':(loc+(m[1].length-m[2].length)),'endloc':(loc+m[1].length),'variable':v}},parse_unit:function(fn,str,no_divisor){if((fn.trim(str)).length==0)return[];var pos=str.indexOf('/');if(pos>=0){if(no_divisor!=null||pos==0||pos>=str.length-1)return null;var left=fn.trim(str.substr(0,pos));var right=fn.trim(str.substr(pos+1));if(right[0]=='('&&right[right.length-1]==')')right=right.substr(1,right.length-2);var uleft=fn.parse_unit(fn,left,!0);var uright=fn.parse_unit(fn,right,!0);if(uleft==null||uright==null)return null;var unit=uleft;var unit_set={};for(var i=0;i<uleft.length;i++)
unit_set[uleft[i][0]]=uleft[i][1];for(var i=0;i<uright.length;i++){if(uright[i][0]in unit_set)return null;var exponent=-uright[i][1];unit_set[uright[i][0]]=exponent;unit.push([uright[i][0],exponent])}
return uleft}
var unit=[];var unit_set={};var candidates=str.replace(/\s*\^\s*/,'^').split(' ');for(var i=0;i<candidates.length;i++){var candidate=candidates[i];var ex=candidate.split('^');var name=ex[0];if(ex.length>1&&(name.length==0||ex[1].length==0))return null;if(name.length==0)continue;if(/^[^\]\[)(}{><0-9.,:;`~!@#^&*\/?|_=+ -]+$/.test(name)==!1)return null;var exponent=null;if(ex.length>1){var matches=/(.*)([0-9]+)(.*)/.exec(ex[1]);if(matches.length==0)return null;if(matches[1]==''&&matches[3]=='')exponent=parseInt(matches[2]);if(matches[1]=='-'&&matches[3]=='')exponent=-parseInt(matches[2]);if(matches[1]=='(-'&&matches[3]==')')exponent=-parseInt(matches[2]);if(exponent==null)return null}else exponent=1;if(name in unit_set)return null;unit.push([name,exponent]);unit_set[name]=exponent}
return unit},format_number:function(number,is_original){try{if(is_original==null)is_original=!1;if(is_original){if(/[eE]/.exec(number)==null)return number;var standardform=number;var symbol=''}else{var value=parseFloat(number);var absnum=Math.abs(value);if(absnum==0)return number;var loc=number.search(/[eE]/);var standardform=value.toExponential();var newvalue=parseFloat(standardform);var is_equal=value==newvalue;if(is_equal&&loc==-1&&absnum>=Math.pow(10.,-2)&&absnum<=Math.pow(10.,6))
return number;var symbol=''}
var s=standardform.split(/[eE]/);var decimal=s[0].replace(/(\.)?0*$/,'');var exponent=(s[1][0]=='+'?s[1].substr(1):s[1][0]=='-'?'\u2212'+s[1].substr(1):s[1]);var newform=decimal+(exponent==0?'':'\u00D7'+'10<sup>'+exponent+'</sup>');return symbol+newform}catch(e){return''}},format_unit:function(base_units){try{var res=[];for(var i=0;i<base_units.length;i++){var exponent=base_units[i][1]<0?'\u2212'+Math.abs(base_units[i][1]):base_units[i][1];res[i]=''+base_units[i][0]+(base_units[i][1]==1?'':'<sup>'+exponent+'</sup>')}
return res.join('\u00b7')}catch(e){return''}},trim:function(str){return str.replace(/^\s+|\s+$/g,'')}};function init(common,types){var others=[];var count=0;var inputs=document.getElementsByTagName('input');for(i=0;i<inputs.length;i++){var input=inputs[i];if(input.type!='text')continue;if(input.name.indexOf('postunit')==0){input.classList.add('formulas_editing_unit');input.title=M.util.get_string('unit','qtype_formulas')}
var type=classify(input.className,types);if(type==null)continue;var self={};self.input=input;self.which=count;self.answered=!1;self.correct=!1;self.cur_value=null;self.last_value=null;self.func=type.func;self.show_info=(type.show_type||type.show_interpretation);self.show_type=type.show_type;self.show_sign=type.show_sign;self.show_interpretation=type.show_interpretation;self.title=input.title;input.title='';var warning_inner=document.createElement('img');warning_inner.src=M.util.image_url('warning','qtype_formulas');warning_inner.className='formulas_input_warning';warning_inner.style.display='none';var warning=document.createElement('span');warning.className='formulas_input_warning_outer';warning.appendChild(warning_inner);input.parentNode.insertBefore(warning,input.nextSibling);var info_inner=document.createElement('div');info_inner.className='formulas_input_info';info_inner.style.display='none';info_inner.style.width=Math.max(100,input.clientWidth+input.clientLeft)+'px';var info=document.createElement('div');info.className='formulas_input_info_outer';info.appendChild(info_inner);input.parentNode.insertBefore(info,input);if(self.show_type){var info_inner_title=document.createElement('div');info_inner_title.className='formulas_input_info_title';info_inner_title.innerHTML=self.title;info_inner.appendChild(info_inner_title)}
var info_inner_interpretation=document.createElement('div');info_inner_interpretation.className='formulas_input_info_interpretation';info_inner.appendChild(info_inner_interpretation);self.warning=warning_inner;self.info=info_inner;self.interpretation=info_inner_interpretation;others[count]=self;count++;input.formulas={};input.formulas.common=common;input.formulas.self=self;input.onblur=function(){this.formulas.common.fn.stop(this.formulas.common,this.formulas.self)};input.onfocus=function(){this.formulas.common.fn.monitor(this.formulas.common,this.formulas.self)};input.onkeyup=function(){this.formulas.common.fn.update(this.formulas.common,this.formulas.self)}}
return others};function classify(className,types){var classes=className.split(' ');for(var i=0;i<classes.length;i++)
for(var j=0;j<types.length;j++)
if(classes[i]=='formulas_'+types[j][0])
return{func:'check_'+types[j][0],show_type:types[j][1],show_interpretation:types[j][2],show_sign:types[j][3]};return null}
function unittest(){var numcase=0;var numcorrect=0;var parsingtestcases=[['number',!0,'3'],['number',!0,'3.'],['number',!0,'.3'],['number',!0,'3.1'],['number',!0,'3.1e-10'],['number',!0,'3.e10'],['number',!0,'.3e10'],['number',!0,'-3'],['number',!0,'+3'],['number',!0,'-3.e10'],['number',!0,'-.3e10'],['number',!0,'pi'],['number',!1,'- 3'],['number',!1,'+ 3'],['number',!1,'3 e10'],['number',!1,'3e 10'],['number',!1,'3e8e8'],['number',!1,'3+10*4'],['number',!1,'3+10^4'],['number',!1,'sin(3)'],['number',!1,'3+exp(4)'],['number',!1,'3*4*5'],['number',!1,'3 4 5'],['number',!1,'a*b'],['number',!1,'#'],['numeric',!0,'3+10*4/10^4'],['numeric',!1,'sin(3)'],['numeric',!1,'3+exp(4)'],['numerical_formula',!0,'3.1e-10'],['numerical_formula',!0,'- 3'],['numerical_formula',!1,'3 e10'],['numerical_formula',!1,'3e 10'],['numerical_formula',!1,'3e8e8'],['numerical_formula',!1,'3e8e8e8'],['numerical_formula',!0,'3+10*4/10^4'],['numerical_formula',!0,'sin(3)-3+exp(4)'],['numerical_formula',!0,'3*4*5'],['numerical_formula',!0,'3 4 5'],['numerical_formula',!0,'3e8 4.e8 .5e8'],['numerical_formula',!0,'3e8(4.e8+2)(.5e8/2)5'],['numerical_formula',!0,'3e8(4.e8+2) (.5e8/2)5'],['numerical_formula',!0,'3e8 (4.e8+2)(.5e8/2) 5'],['numerical_formula',!0,'3e8 (4.e8+2) (.5e8/2) 5'],['numerical_formula',!0,'3(4.e8+2)3e8(.5e8/2)5'],['numerical_formula',!0,'3+4^9'],['numerical_formula',!0,'3+(4+5)^9'],['numerical_formula',!0,'3+(4+5)^(6+7)'],['numerical_formula',!0,'3+sin(4+5)^(6+7)'],['numerical_formula',!0,'3+exp(4+5)^sin(6+7)'],['numerical_formula',!0,'3+4^-(9)'],['numerical_formula',!0,'3+4^-9'],['numerical_formula',!0,'3+exp(4+5)^-sin(6+7)'],['numerical_formula',!0,'1+ln(3)'],['numerical_formula',!0,'1+log10(3)'],['numerical_formula',!0,'pi'],['numerical_formula',!1,'pi()'],['algebraic_formula',!0,'- 3'],['algebraic_formula',!0,'3 e10'],['algebraic_formula',!0,'3e 10'],['algebraic_formula',!0,'3e8e8'],['algebraic_formula',!0,'3e8e8e8'],['algebraic_formula',!0,'sin(3)-3+exp(4)'],['algebraic_formula',!0,'3e8 4.e8 .5e8'],['algebraic_formula',!0,'3e8(4.e8+2)(.5e8/2)5'],['algebraic_formula',!0,'3+exp(4+5)^sin(6+7)'],['algebraic_formula',!0,'3+4^-(9)'],['algebraic_formula',!0,'sin(a)-a+exp(b)'],['algebraic_formula',!0,'a*b*c'],['algebraic_formula',!0,'a b c'],['algebraic_formula',!0,'a(b+c)(x/y)d'],['algebraic_formula',!0,'a(b+c) (x/y)d'],['algebraic_formula',!0,'a (b+c)(x/y) d'],['algebraic_formula',!0,'a (b+c) (x/y) d'],['algebraic_formula',!0,'a(4.e8+2)3e8(.5e8/2)d'],['algebraic_formula',!0,'pi'],['algebraic_formula',!0,'a+x^y'],['algebraic_formula',!0,'3+x^-(y)'],['algebraic_formula',!0,'3+x^-y'],['algebraic_formula',!0,'3+(u+v)^x'],['algebraic_formula',!0,'3+(u+v)^(x+y)'],['algebraic_formula',!0,'3+sin(u+v)^(x+y)'],['algebraic_formula',!0,'3+exp(u+v)^sin(x+y)'],['algebraic_formula',!0,'a+exp(a)(u+v)^sin(1+2)(b+c)'],['algebraic_formula',!0,'a+exp(u+v)^-sin(x+y)'],['algebraic_formula',!0,'a+b^c^d+f'],['algebraic_formula',!0,'a+b^(c^d)+f'],['algebraic_formula',!0,'a+(b^c)^d+f'],['algebraic_formula',!0,'a+b^c^-d'],['algebraic_formula',!0,'1+ln(a)+log10(b)'],['algebraic_formula',!0,'asin(w t)'],['algebraic_formula',!0,'a sin(w t)+ b cos(w t)'],['algebraic_formula',!0,'2 (3) a sin(b)^c - (sin(x+y)+x^y)^-sin(z)c tan(z)(x^2)'],['algebraic_formula',!1,'a-'],['algebraic_formula',!1,'*a'],['algebraic_formula',!0,'a**b'],['algebraic_formula',!1,'a+^c+f'],['algebraic_formula',!1,'a+b^^+f'],['algebraic_formula',!1,'a+(b^c)^+f'],['algebraic_formula',!1,'a+((b^c)^d+f'],['algebraic_formula',!1,'a+(b^c+f'],['algebraic_formula',!1,'a+b^c)+f'],['algebraic_formula',!1,'a+b^(c+f'],['algebraic_formula',!1,'a+b)^c+f'],['algebraic_formula',!1,'pi()'],['algebraic_formula',!1,'sin 3'],['algebraic_formula',!1,'1+sin*(3)+2'],['algebraic_formula',!1,'1+sin^(3)+2'],['algebraic_formula',!1,'a sin w t'],['algebraic_formula',!1,'1==2?3:4'],['algebraic_formula',!1,'a=b'],['algebraic_formula',!1,'3&4'],['algebraic_formula',!1,'3==4'],['algebraic_formula',!1,'3&&4'],['algebraic_formula',!1,'3!'],['algebraic_formula',!1,'`'],['algebraic_formula',!1,'@'],['unit',!0,'m'],['unit',!0,'km'],['unit',!0,'m^2'],['unit',!0,'m ^ 2'],['unit',!0,'m^-2'],['unit',!0,'m^(-2)'],['unit',!0,'m ^ -2'],['unit',!0,'m/s'],['unit',!0,'m s^-1'],['unit',!0,'m s^(-1)'],['unit',!0,'kg m/s'],['unit',!0,'kg m s^-1'],['unit',!0,'kg m^2'],['unit',!0,'kg m ^ 2'],['unit',!1,'2.1'],['unit',!1,'^2'],['unit',!1,'m^+2'],['unit',!1,'kg m s ^ - 1'],['unit',!1,'`'],['unit',!1,'@'],['number_unit',!0,'.3'],['number_unit',!0,'3.1'],['number_unit',!0,'3.1e-10'],['number_unit',!0,'3m'],['number_unit',!0,'3kg m/s'],['number_unit',!0,'3.m/s'],['number_unit',!0,'3.e-10m/s'],['number_unit',!1,'- 3m/s'],['number_unit',!1,'3 e10 m/s'],['number_unit',!1,'3e 10 m/s'],['number_unit',!1,'3e8e8 m/s'],['number_unit',!1,'3+10*4 m/s'],['number_unit',!1,'3+10^4 m/s'],['number_unit',!1,'sin(3) m/s'],['number_unit',!1,'3+exp(4) m/s'],['number_unit',!1,'3*4*5 m/s'],['number_unit',!1,'3 4 5 m/s'],['number_unit',!1,'m/s'],['number_unit',!1,'#'],['numeric_unit',!0,'3+4 5+10^4kg m/s'],['numeric_unit',!1,'sin(3)kg m/s'],['numerical_formula_unit',!0,'3.1e-10kg m/s'],['numerical_formula_unit',!0,'-3kg m/s'],['numerical_formula_unit',!0,'- 3kg m/s'],['numerical_formula_unit',!0,'3e'],['numerical_formula_unit',!0,'3e8'],['numerical_formula_unit',!0,'3e8e'],['numerical_formula_unit',!0,'3+4 5+10^4kg m/s'],['numerical_formula_unit',!0,'sin(3)kg m/s'],['numerical_formula_unit',!0,'3*4*5 kg m/s'],['numerical_formula_unit',!0,'3 4 5 kg m/s'],['numerical_formula_unit',!0,'3e8(4.e8+2)(.5e8/2)5kg m/s'],['numerical_formula_unit',!0,'3+exp(4+5)^sin(6+7)kg m/s'],['numerical_formula_unit',!0,'3+exp(4+5)^-sin(6+7)kg m/s'],['numerical_formula_unit',!0,'3exp^2'],['numerical_formula_unit',!1,'3 e8'],['numerical_formula_unit',!1,'3e 8'],['numerical_formula_unit',!1,'3e8e8'],['numerical_formula_unit',!1,'3e8e8e8'],['numerical_formula_unit',!1,'3+exp(4+5).m/s'],['numerical_formula_unit',!1,'3+(4.m/s'],['numerical_formula_unit',!1,'3+4.)m/s'],['numerical_formula_unit',!1,'3 m^'],['numerical_formula_unit',!1,'3 m/'],['numerical_formula_unit',!1,'3 /s'],['numerical_formula_unit',!1,'3 m+s'],['numerical_formula_unit',!1,'1==2?3:4'],['numerical_formula_unit',!1,'a=b'],['numerical_formula_unit',!1,'3&4'],['numerical_formula_unit',!1,'3==4'],['numerical_formula_unit',!1,'3&&4'],['numerical_formula_unit',!1,'3!'],['numerical_formula_unit',!1,'`'],['numerical_formula_unit',!1,'@']];var failcases=[];for(var i=0;i<parsingtestcases.length;i++){var tc=parsingtestcases[i];var result=fn['check_'+tc[0]](fn,tc[2]);var evaluable=(result!=null);var iscorrect=evaluable==tc[1];if(iscorrect)numcorrect++;else failcases.push(tc[2]);numcase++}
return{'numcorrect':numcorrect,'numcase':numcase,'failcases':failcases}};function signal_fail(common){var warning=document.createElement('span');warning.innerHTML='<div style="position:fixed; bottom:20px; right:5px;">'+(unittest_fail_show_details?common.testresult.failcases.join('<br>'):'')+'<img src="'+M.util.image_url('warning','qtype_formulas')+'" title="Format check initialization fail ('+(common.testresult.numcase-common.testresult.numcorrect)+'/'+common.testresult.numcase+')"></img>'+'</div>';document.body.insertBefore(warning,null)}
var common={};common.fn=fn;common.ready=!1;common.testresult=unittest();common.pass=common.testresult.numcorrect==common.testresult.numcase;if(!common.pass&&unittest_fail_show_icon)signal_fail(common);common.others=init(common,types);common.ready=!0;for(var i=0;i<common.others.length;i++)try{common.fn.update(common,common.others[i])}catch(e){}};window.onload=(function(oldfunc,newfunc){if(oldfunc&&typeof oldfunc=='function')
return function(){oldfunc();newfunc()}else return newfunc})(window.onload,function(){formulas_format_check()})